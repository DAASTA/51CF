<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>FC15</title>
    <script type="text/javascript" src="js/phaser.min.js"></script>
    <script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
    <script>
        var jsonData;
        window.onload = function () {

            var logFile = document.getElementById('json-selector');
            //var jsonData;
            logFile.addEventListener('change', function () {
                if (!logFile.value) {
                    alert('没有选择文件');
                    return;
                }
                var file = logFile.files[0];
                if (file.size == 0) {
                    alert('Empty file!');
                    return;
                }
                var reader = new FileReader();
                reader.onload = function (e) {
                    jsonData = JSON.parse(e.target.result);
                    //console.log(jsonData);
                    loadGame();
                };
                reader.readAsText(file);
            });
        }
    </script>
    <script>
        function drawCircle(canvasId, ori_data_arr, color_arr, text_arr) {
            var sum = 0;
            $.each(ori_data_arr, function(i, num) {
                sum += num;
            });
            var data_arr = new Array(ori_data_arr.length);
            $.each(data_arr, function(i, num) {
                data_arr[i] = ori_data_arr[i] / sum;
            });
            var c = document.getElementById(canvasId);
            var ctx = c.getContext("2d");
            c.height=c.height;

            var radius = c.height / 2 - 20; //半径  
            var ox = radius + 20, oy = radius + 20; //圆心  

            var width = 30, height = 10; //图例宽和高  
            var posX = ox * 2 + 20, posY = 30;   //  
            var textX = posX + width + 5, textY = posY + 10;

            var startAngle = 0; //起始弧度  
            var endAngle = 0;   //结束弧度  
            for (var i = 0; i < data_arr.length; i++) {
                //绘制饼图  
                endAngle = endAngle + data_arr[i] * Math.PI * 2; //结束弧度  
                ctx.fillStyle = color_arr[i];
                ctx.beginPath();
                ctx.moveTo(ox, oy); //移动到到圆心  
                ctx.arc(ox, oy, radius, startAngle, endAngle, false);
                ctx.closePath();
                ctx.fill();
                startAngle = endAngle; //设置起始弧度  

                //绘制比例图及文字  
                ctx.fillStyle = color_arr[i];
                ctx.fillRect(posX, posY + 20 * i, width, height);
                ctx.moveTo(posX, posY + 20 * i);
                ctx.font = 'bold 12px 微软雅黑';    //斜体 30像素 微软雅黑字体  
                ctx.fillStyle = color_arr[i]; //"#000000";  
                var percent = text_arr[i] + "：" + Math.round(data_arr[i] * 10000) / 100 + "%";
                ctx.fillText(percent, textX, textY + 20 * i);
            }
        } 
    </script>
    <script type="text/javascript" src="js/main.js"></script>
    <script type="text/javascript" src="js/cells.js"></script>
    <script type="text/javascript" src="js/tentacles.js"></script>

</head>

<body>
    <div>
        <input id="json-selector" type="file" />
    </div>
    <div id="game"></div>
    <canvas id="chart" width="500" height="300" style="position: absolute; left: 820px; border:2px solid #0026ff;" >
</body>

</html>